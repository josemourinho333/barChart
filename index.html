<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pyoo Bar Chart</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
  <header>
    <h1>Premier League's Current Top Scorers vs Most Goals Scored In a Season</h1>
    <h4>2022 - 2023
</h4>
  </header>

  <div class="button-container">
    <div class="create-container button-group">
      <button class="new">Create</button>
      <div class="create-data">Bar label names separated by commas, here's sample data.</div>
      <textarea name="" id="bar-labels" cols="100" rows="1" placeholder="Names - Separate by comma" class="create-data">Mohamed Salah - 2017/18,Mohamed Salah,Son Heung-Min,Cristiano Ronaldo</textarea>
      <div class="create-data">Bar value numbers separated by commas, here's sample data.</div>
      <textarea name="" id="bar-values" cols="100" rows="1" placeholder="Numbers -Separate by comma" class="create-data">32,22,19,18</textarea>
      <div class="create-data">Enter a categorization name for the bar labels. Sample given.</div>
      <textarea name="" id="bar-header-name" cols="100" rows="1" placeholder="" class="create-data">Player Name</textarea>
      <div class="create-data">Two numbers, separate by a comma, sets max value for legend and amount to increment by. Sample given. /n I'll add a function to add ticks later. </div>
      <textarea name="" id="bar-legends" cols="100" rows="1" placeholder="Numbers -Separate by comma" class="create-data">35,5</textarea>
      <button class="subit-new create-data">Submit</button>
    </div>
  </div>

  <div id="container"></div>

  <div class="button-container">
    <div class="add-container button-group">
      <input type="text" class="new-name" placeholder="Name">
      <input type="number" class="new-value" placeholder="Goals">
      <input type="text" class="color" placeholder="Hexcode Color">
      <button id="add">Add</button>
    </div>
    <div class="edit-container button-group">
      <button id="edit">Edit Data</button>
      <textarea name="edit-area" id="edit-space" cols="100" rows="10" class="edit-data"></textarea>
      <button id="submit" class="edit-data">Submit</button>
    </div>
  </div>

  <script>
    // Create button function - controls displaying info to create a chart and submit and cancelling.
    $('.new').click(function() {
      if ($(this).text() === 'Create') {
        $(this).text('Cancel');
        $('.create-data').show();
      } else {
        $(this).text('Create');
        $('.create-data').hide();
      }
    });

    // Main function of the project. Creates a bar chart after grabbing the values from create section.
    $('.subit-new').click(function drawBarChart(data, options, element) {

      // Declaring variables and grabbing the inputs for the data that will be displayed in the chart then storing them as an array.
      let barNames = $('#bar-labels').text();
      let barNamesArray = barNames.split(',');
      let barValues = $('#bar-values').text();
      let barValuesArray = barValues.split(',');
      data = barNamesArray.concat(barValuesArray);

      // Declaring variables and grabbing the inputs for the chart settings storing them as an array.
      let barHeader = $('#bar-header-name').text();
      let barHeaderArray = [barHeader];
      let barLegends = $('#bar-legends').val();
      let barLegendsArray = barLegends.split(',');
      options = barHeaderArray.concat(barLegendsArray);

      // Declaring a variable where the chart will be rendered inside
      element = $('#container');

      // Called to make the bars and the bars names and append them into appropriate html structure with right classes with random colors.
      const barsOut = (data, options, element) => {
          let maxTick = options[1];
          for (let i = 0; i < data.length/2; i++) {
            let colorR = Math.floor((Math.random() * 256));
            let colorG = Math.floor((Math.random() * 256));
            let colorB = Math.floor((Math.random() * 256));
            let rgb = `${colorR}, ${colorG}, ${colorB}`;
            let realWidth = Math.floor((data[i+(data.length/2)]/maxTick)*100);

            let $gridContainer = $('<div/>', {class: 'grid-container'}),
                $gridName = $('<div/>', {class: 'name', text: data[i], style: 'background-color: rgb(' + rgb + ');'}),
                $gridValue = $('<div/>', {
                  class: 'value',
                  text: data[i+(data.length/2)],
                  style: 'width: ' + realWidth + '%;' + 'background-color: rgb(' + rgb + ');'});

            $gridContainer.append($gridName).appendTo(element);
            $gridContainer.append($gridValue).appendTo(element);
          }
        };

        // Called to make the bar header label and the ticks for the graph
        const setTicks = (options, element) => {
          let nameHeader = options[0];
          let maxTick = parseInt(options[1]);
          let minTick = parseInt(options[2]);
          let tickBy = parseInt(options[2]);
          let ticks = maxTick/tickBy;

          let $gridHeaderContainer = $('<div/>', {
                class: 'grid-header-container',
                style: 'grid-template-columns: 300px repeat(' + ticks + ', 1fr)'
              }),
              $nameHeader = $('<div/>', {class: 'name-header', text: nameHeader});

          $gridHeaderContainer.append($nameHeader).appendTo(element);

          for (let j = 0; j < ticks; j++) {
            let $valueHeader = $('<div/>', {class: 'value-header', text: (minTick += tickBy) - tickBy});
            $gridHeaderContainer.append($valueHeader).appendTo(element);
          }
        };

        setTicks(options, element);
        barsOut(data, options, element);
        // Hiding the create section once submit button is clicked
        $('.new').text('Create');
        $('.create-data').hide();
    });

    // Function that will grab the inputs and add a new bar
    $('#add').click(function(name, value, color) {
      $('.edit-data').hide();
      $('#edit').text('Edit Data');
      name = $('.new-name').val();
      value = parseInt($('.new-value').val());
      color = $('.color').val();
      let realWidth = Math.floor((parseInt($('.new-value').val())/35) * 100);
      let $gridContainer = $('<div/>', {class: 'grid-container'}),
          $gridName = $('<div/>', {class: 'name', text: name, style: 'background-color:' + color}),
          $gridValue = $('<div/>', {
            class: 'value',
            text: value,
            style: 'width:' + realWidth + '%' + ';' + 'background-color:' + color});

      $gridContainer.append($gridName).appendTo('#container');
      $gridContainer.append($gridValue).appendTo('#container');
    });

    // Function that will display textarea and submit button for a user to see. Grabs in the current logged bar data and puts them in the textarea.
    $('#edit').click(function() {
      let editData = $('.edit-data');
      let editButton = $('#edit');

      if (editButton.text() === 'Edit Data') {
        editData.show();
        editButton.text('Close');
        const nameArray = [];
        const valueArray = [];
        const names = $('.name');
        const values = $('.value');
        for (let i = 0; i < names.length; i++) {
          nameArray.push(names[i].innerText);
        };

        for (let j = 0; j < values.length; j++) {
          valueArray.push(values[j].innerText);
        };

        $('#edit-space').text(nameArray + ',' + valueArray);

      } else {
        editData.hide();
        editButton.text('Edit Data');
      };
    });

    // Function called when Submit button is called after editing the values inside the text area.
    $('#submit').click(function() {
      $('.grid-container').remove();

      let changes = $('#edit-space').val();
      let changesArray = changes.split(',');
      let maxTick = $('.value-header').last();
      for (let i = 0; i < changesArray.length/2 ; i++) {
        let colorR = Math.floor((Math.random() * 256));
        let colorG = Math.floor((Math.random() * 256));
        let colorB = Math.floor((Math.random() * 256));
        let rgb = `${colorR}, ${colorG}, ${colorB}`;
        let realWidth = Math.floor((changesArray[i+(changesArray.length/2)]/maxTick.text())*100);

        let $gridContainer = $('<div/>', {class: 'grid-container'}),
            $gridName = $('<div/>', {class: 'name', text: changesArray[i], style: 'background-color: rgb(' + rgb + ');'}),
            $gridValue = $('<div/>', {
              class: 'value',
              text: changesArray[i+(changesArray.length/2)],
              style: 'width: ' + realWidth + '%;' + 'background-color: rgb(' + rgb + ');'});

        $gridContainer.append($gridName).appendTo($('#container'));
        $gridContainer.append($gridValue).appendTo($('#container'));
      }

      $('#edit-space').empty();
      $('.edit-data').hide();
      $('#edit').text('Edit Data');
    });
  </script>
</body>
</html>
